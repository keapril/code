# 院內碼查詢系統 PRD v1.0

## 產品目標
提供醫療人員快速查詢各醫院產品院內碼的系統。

## 核心功能

### 1. 資料上傳
- 支援 Excel/CSV 格式
- 自動解析醫院、型號、院內碼
- 儲存至 Firebase Firestore
- 密碼保護（197）

### 2. 查詢功能
- **單一/多重醫院選擇**
  - Single 模式：下拉選單
  - Multiple 模式：多選
- **院內碼搜尋**
  - 支援模糊搜尋
  - 同時搜尋院內碼、批價碼、原始備註
- **型號/產品名關鍵字搜尋**
  - 支援多關鍵字（空格分隔）
  - 自動去除特殊符號
- **複合條件篩選**
  - 醫院 + 院內碼 + 關鍵字

### 3. 權限管理
- **公開模式**：南區醫院（成大、奇美、高醫等）
- **Admin 模式**：特定醫院（慈濟、三總等）
  - 密碼：163

### 4. 資料顯示
- 表格顯示：醫院名稱、產品名稱、型號、院內碼、批價碼
- 自訂樣式（Morandi 色系）
- 結果計數

## 技術架構
- **前端**：Streamlit
- **資料庫**：Firebase Firestore
  - Collection: `medical_products`
  - Document: `main_database`
- **部署**：Streamlit Cloud
- **版本控制**：GitHub (keapril/code)

## 資料結構

### Firestore Document
```json
{
  "data": [
    {
      "醫院名稱": "成大",
      "型號": "ABC123",
      "產品名稱": "產品A",
      "健保碼": "12345",
      "院內碼": "H001",
      "批價碼": "B001",
      "原始備註": "#H001 (ABC123)",
      "搜尋用字串": "abc123 產品a 12345"
    }
  ],
  "updated_at": "2026-01-16 16:00",
  "record_count": 1234
}
```

## 醫院白名單

### 公開顯示（南區醫院）
成大、台南市立、麻豆新樓、臺南新樓、安南新樓、奇美永康、奇美佳里、奇美柳營、嘉基、嘉義陽明、嘉榮、義大、高雄長庚、高醫、屏基等

### Admin 模式（特定醫院）
新店慈濟、台北慈濟、內湖三總、三軍總醫院、松山三總、國立陽明大學、輔大、羅東博愛等

## 資料處理邏輯

### 1. Excel/CSV 解析
- 自動偵測標題欄（找「型號」）
- 識別關鍵列：型號、產品名稱、健保碼、許可證
- 過濾無效資料（ACP、祐新、銀鐸等）

### 2. 院內碼解析
- **一般醫院**：`#院內碼 (規格)`
- **台南市立/秀傳**：
  - `#B開頭` → 院內碼
  - `#數字開頭` → 型號
  - `#其他` → 批價碼

### 3. 搜尋字串生成
```
搜尋用字串 = 型號 + 型號(去特殊符號) + 產品名稱 + 健保碼 + 許可證
```

## 未來規劃

### v1.1（短期）
- [ ] 批次匯出功能（Excel）
- [ ] 歷史版本比對
- [ ] 更多醫院支援

### v2.0（中期）
- [ ] 使用者登入系統
- [ ] 個人化收藏功能
- [ ] 資料變更通知

### v3.0（長期）
- [ ] API 介面
- [ ] 行動 App
- [ ] 多語系支援

## 已知問題
- 快取時間 5 分鐘（可能看到舊資料）
- 大量資料上傳較慢（Firestore 限制）

## 更新日誌

### v1.0 (2026-01-16)
- ✅ 初版發布
- ✅ 基本查詢功能
- ✅ Firebase 整合
- ✅ 權限管理
